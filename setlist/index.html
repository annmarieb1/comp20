<!doctype html>
<html>
<head>
	<title>Set List</title>
	<meta charset="utf-8"/>
	<script>
		var setlist = [];
		function loadSongs() {
			var genresArr = ["Pop", "Punk", "Rock", "Country"];

			s = '<select id="genreSelect" onchange="updateList(name)">';
			genresArr.forEach(
				function(genre) {
					s += "<option>" + genre + "</option>";
				}
			)
			s += "</select>";
			document.getElementById("selectForm").innerHTML = s;

			/* Make instance of request object
			 * to make HTTP request after page is loaded
			 */
			request = new XMLHttpRequest();
 
			// Set the URL for the request
			request.open("GET", "https://annmarieb1.github.io/comp20/setlist/setlist.json", true);
 
			// Set up event handler/callback
			request.onreadystatechange = function() { 
				if (request.readyState == 4 && request.status == 200) {
					printList = "";
					result = request.responseText;
					setlist = JSON.parse(result);
					
					setlist.forEach(
						function(song) {
							printList += songString(song);
						}
					)
					
					document.getElementById("raw").innerHTML = result;

					document.getElementById("data").innerHTML = printList;

				} else if (request.readyState == 4 && request.status != 200) {
					document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";

				} else if (request.readyState == 3) {
					document.getElementById("data").innerHTML = "Too soon!  Try again";
				} else {
					document.getElementById("data").innerHTML = "Hang tight...we're trying to get your setlist";
				}

			}
			
			// send request
			request.send();
			console.log("4 - Request sent");
		}

		function songString(song) {
			str = "<p>" + song.title
				+ "<br />" + song.artist
				+ "<br /> Year: " + song.year
				+ "<br /> Genres: <ul>"

			song["genres"].forEach(function(genre) {
				str += "<li> " + genre + "</li>";
			})

			str += "</ul> </p>"
			return str;
		}

		function updateList(genre) {
			printList = ""

			console.log(setlist);
			// setlist.filter(
			// 	function(song) {
			// 		return song["genres"].find != undefined;
			// 	}
			// )

			// alert(setlist);

			// setlist.forEach(
			// 		function(song) {
			// 		printList += songString(song);
			// 	}
			// )

			document.getElementById("data").innerHTML = printList;	
		}
	</script>
</head>


<body onload="loadSongs()">

	<h1>Setlist</h1>
	
	<div id="selectForm"></div>
	<h3>Data</h3>
	<div id="data">Loading...</div>

	<h3>Raw Data</h3>
	<div id="raw"></div>
</body>
</html>